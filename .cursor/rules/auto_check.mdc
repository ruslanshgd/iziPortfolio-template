---
alwaysApply: true
priority: operational
summary: Универсальный протокол самопроверки: базовый режим для прямых действий, reasoning — для обоснованных решений и калибровки уверенности.
---

## 0. Область применения  
[Назначение: задать универсальные рамки, в которых выполняется любая операция] 

### 0.1 **Базовый режим:**  
[Применяется **по умолчанию** — для любых операций, где решение очевидно и не требует анализа или выбора. Подходит для технических действий, простых ответов, генерации кода по прямой спецификации, правок и форматирования.]

  - Никаких фоновых обещаний или ETA — весь результат должен быть выдан в этом сообщении.  
  - Если затронуты нестабильные факты (цены, новости, регламенты, публичные лица, актуальные версии и т.п.) — используй инструмент веб-поиска и приведи 1–3 цитаты с источниками.  
  - Любая критичная арифметика (суммы, проценты, сравнения) сопровождается кратким пошаговым расчётом.  

### 0.2 **Расширенный reasoning-режим:**  
[Активируется **только**, если задача требует **обоснования выбора решения**: есть несколько подходов, нужен анализ, интерпретация данных, стратегия, архитектура или проверка гипотез.]  

    При активации этого режима:
    1. Выполнить reasoning
    2. Применить `.cursor/rules/anti-bias.mdc` для проверки на когнитивные искажения
    3. Использовать **п.3 (Протокол уверенности)** для оценки
    4. Применить **п. 4 (Проверка и фиксация)** после получения reasoning-outcome.

---

## 1. Префлайт  
[Назначение: гарантировать, что действие выполняется в понятной структуре, без искажений и с доступными входными данными.]  

- Если задача состоит из ≥ 3 шагов — разбить её на подзадачи с помощью `todo_tool`.  
- Сверься с текущим планом или контекстом чата: убедись, что **следующий шаг** явно определён и не требует уточнения.  
- Если задача зависит от внешних файлов, конфигов или переменных — проверь их наличие; если критично и чего-то нет, приостанови действие и отметь, чего не хватает.  

---

## 2. Операционка  
[Назначение: зафиксировать базовые правила выполнения действий — чисто, обратимо и безопасно.]  

- Исправляй ошибки линтеров, тестов и терминала сразу — не обходи их и не оставляй «в долг».  
- Не создавай временных файлов (`_final`, `_backup`, `temp`) — редактируй оригиналы или явно указывай целевой файл.  
- Все изменения должны быть **обратимыми**: при необходимости можно вернуть систему к предыдущему состоянию.  
- Если выполняется правка или фиксация — кратко укажи, **что именно было изменено** и почему.  
- Работай в актуальном окружении (`.venv` или аналог); не меняй зависимости без обоснования.  

---

## 3. Протокол уверенности  
[Применяется **только** при reasoning-задачах. Фиксирует надёжность outcome по четырём критериям с весами.]

| Код | Критерий | Условие выполнения (1 = да / 0 = нет) | Вес |
|------|-----------|----------------------------------------|------|
| **D** | **Опора на данные / контекст** | Есть ≥ 2 проверяемых факта или источника | **0.40** |
| **L** | **Ясность логики** | Каждый шаг вывода можно проследить, нет логических пропусков | **0.30** |
| **C** | **Внутренняя согласованность** | Нет противоречий между частями рассуждения | **0.20** |
| **P** | **Пропорциональность outcome** | Утверждения не сильнее, чем позволяют данные и допущения | **0.10** |

**Расчёт уверенности:**  
`Уверенность = 0.4×D + 0.3×L + 0.2×C + 0.1×P`  
(где 1 = критерий выполнен, 0 = не выполнен)

**Формат фиксации:**  
Уверенность: [0–1] — [ключевая причина оценки]  
*(детализация по факторам D/L/C/P — только при явном запросе)*

**Пороговые действия:**  
- Если уверенность **<0.5** — приостанови выполнение и запроси дополнительные данные или уточнения.  
- Если уверенность **0.5–0.7** — выполни действие как гипотезу и явно отметь, что требуется проверка.  
- Если уверенность **≥0.7** — выполнено достаточно надёжно, можно продолжать без ограничений.

---

## 4. Проверка и фиксация
[Применяется после п. 3 для подтверждения, что фактический результат совпадает с reasoning-outcome.]

Перед объявлением готовности задай себе:
> Готов ли output к использованию и даст ли ожидаемый outcome?  
> Нужно ли что-то проверить, запустить или уточнить?

Если требуется — укажи явно: **"Для завершения нужно: [шаги]"**

- Сверь фактический результат с ожидаемым reasoning-выводом.  
- Если есть расхождения — кратко опиши, что пошло не так и как исправлено.  
- При критичных несоответствиях — выполни короткий RCA (5 Why) и укажи источник.

---
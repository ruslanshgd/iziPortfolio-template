# Архитектура Telegram бота для создания портфолио

## Общая схема работы

```
┌─────────────┐
│  Пользователь│
│  (Telegram) │
└──────┬──────┘
       │
       │ 1. Запускает /start
       │ 2. Вводит данные профиля
       │ 3. Дает GitHub токен
       ▼
┌─────────────────┐
│  Telegram Bot   │
│  (ваш сервер)   │
└──────┬──────────┘
       │
       │ 3. Создает репозиторий из шаблона
       │    (используя токен пользователя)
       ▼
┌─────────────────────────────┐
│  GitHub API                 │
│  - Создает repo из шаблона  │
│  - Загружает hugo.toml      │
│  - Загружает фото           │
└──────┬──────────────────────┘
       │
       │ 4. Репозиторий создается
       │    на аккаунте ПОЛЬЗОВАТЕЛЯ
       ▼
┌─────────────────────────────┐
│  GitHub (аккаунт            │
│   пользователя)             │
│  - username/portfolio       │
│  - GitHub Actions запускается│
└──────┬──────────────────────┘
       │
       │ 5. Автоматическая сборка
       ▼
┌─────────────────────────────┐
│  GitHub Pages               │
│  https://username.github.io│
│  /portfolio/                │
└─────────────────────────────┘
```

## Настройка шаблона-репозитория

### Шаг 1: Создание репозитория на вашем GitHub

1. Перейдите на https://github.com/ruslanshgd
2. Создайте новый репозиторий: `iziPortfolio-template`
3. **Важно**: Сделайте его **публичным** (рекомендуется) или приватным

### Шаг 2: Загрузка текущего проекта

```bash
cd /Users/ruslansharipov/Development/cursor/projects/iziPortfolio

# Инициализируйте git (если еще не сделано)
git init

# Добавьте remote
git remote add origin https://github.com/ruslanshgd/iziPortfolio-template.git

# Закоммитьте и запушьте
git add .
git commit -m "Initial commit: Hugo portfolio template"
git push -u origin main
```

### Шаг 3: Настройка как шаблона

1. Перейдите в Settings репозитория
2. Включите опцию **"Template repository"**
3. Сохраните изменения

### Шаг 4: Настройка GitHub Actions (опционально)

Убедитесь, что в репозитории есть `.github/workflows/deploy.yml` для автоматического деплоя на GitHub Pages.

## Как работает создание репозитория

### Текущий код (без оплаты)

```python
# github_client.py
def ensure_repo_from_template(...):
    # Использует токен ПОЛЬЗОВАТЕЛЯ
    # Создает репозиторий на аккаунте ПОЛЬЗОВАТЕЛЯ
    # Из вашего шаблона ruslanshgd/iziPortfolio-template
```

### Что происходит:

1. Пользователь дает свой GitHub токен боту
2. Бот использует этот токен для вызова GitHub API
3. GitHub API создает новый репозиторий из шаблона `ruslanshgd/iziPortfolio-template`
4. **Новый репозиторий создается на аккаунте пользователя**, а не на вашем
5. Бот записывает туда `hugo.toml` и фото
6. GitHub Actions автоматически собирает сайт

## Варианты для платного доступа

### Вариант 1: Публичный шаблон + проверка в боте (рекомендуется)

**Плюсы:**
- ✅ Простота управления
- ✅ Не нужно управлять доступом к шаблону
- ✅ Легко добавить проверку подписки

**Минусы:**
- ⚠️ Шаблон публичный (но это не проблема, так как репозитории создаются у пользователей)

**Реализация:**
```python
# В bot.py перед созданием репозитория
async def check_subscription(user_id: int) -> bool:
    # Проверка оплаты через платежную систему
    # Stripe, ЮKassa, и т.д.
    return is_paid(user_id)

async def _finalize_profile_and_deploy(...):
    if not await check_subscription(message.from_user.id):
        await message.answer("❌ Требуется оплата. Используйте /pay")
        return
    # Создаем репозиторий...
```

### Вариант 2: Приватный шаблон + выдача доступа

**Плюсы:**
- ✅ Шаблон приватный

**Минусы:**
- ❌ Нужно управлять доступом к шаблону для каждого пользователя
- ❌ Сложнее автоматизировать
- ❌ GitHub API ограничения на количество коллабораторов

**Реализация:**
```python
# Добавить пользователя как коллаборатора к шаблону
def grant_template_access(token: str, username: str):
    # POST /repos/{owner}/{repo}/collaborators/{username}
    # Но это сложно масштабировать
```

### Вариант 3: Организация GitHub + команды

**Плюсы:**
- ✅ Централизованное управление
- ✅ Можно использовать GitHub Teams

**Минусы:**
- ❌ Требует GitHub Organization (платно для приватных репозиториев)
- ❌ Более сложная настройка

## Рекомендация

**Используйте Вариант 1** (публичный шаблон + проверка в боте):

1. Создайте публичный репозиторий-шаблон `ruslanshgd/iziPortfolio-template`
2. Добавьте проверку подписки в бот перед созданием репозитория
3. Репозитории будут создаваться на аккаунтах пользователей (они их владельцы)

**Почему это безопасно:**
- Шаблон публичный, но это не проблема — он просто содержит структуру Hugo
- Каждый пользователь получает свой репозиторий на своем аккаунте
- Вы контролируете доступ через проверку оплаты в боте

## Настройка переменных окружения

После создания шаблона обновите `.env`:

```bash
TELEGRAM_BOT_TOKEN=ваш_токен
HUGO_TEMPLATE_OWNER=ruslanshgd
HUGO_TEMPLATE_REPO=iziPortfolio-template
```

## Часто задаваемые вопросы

### Q: Нужен ли мне платный GitHub аккаунт?

**A:** Нет! Публичные репозитории бесплатны. Приватные репозитории тоже бесплатны на GitHub (неограниченно).

### Q: Могут ли пользователи скопировать шаблон без оплаты?

**A:** Да, технически могут скопировать шаблон вручную. Но:
- Бот предоставляет удобный интерфейс
- Автоматическую генерацию `hugo.toml`
- Загрузку фото
- Интеграцию с GitHub Pages

Это и есть ценность сервиса, а не сам шаблон.

### Q: Где создаются репозитории пользователей?

**A:** На аккаунтах самих пользователей. Бот использует их GitHub токен для создания репозитория из вашего шаблона.

### Q: Могу ли я сделать шаблон приватным?

**A:** Да, но тогда нужно будет выдавать доступ каждому пользователю вручную или через API (сложнее). Рекомендую публичный шаблон + проверку оплаты в боте.
